# Описание приложения
Данное микросервисное приложение представляет из себя REST API для работы с событиями, актуальными в городе. Оно позволяет получать, записывать и удалять данные, отправлять сообщения по почте для всех подписанных на рассылку пользователей.

# Получение доступа
Приложение имеет 2 уровня доступа: обычный и привилегированный. Обычный дает доступ на чтение данных (GET), привилегированный дает доступ на запись и удаление данных (PUT, POST, DELETE).

Для получения доступа к эндпоинтам, нужно сначала отправить запрос на /auth/register c телом, в котором указаны email и password (а также поля is_verified, is_active, is_superuser, is_recipient), потом отправить данные логина и пароля на адрес /auth/login. Для отправки данных при входе в систему необходимо указать заголовки 
```
		'accept': 'application/json',
		'Content-Type': 'application/x-www-form-urlencoded'
```
Тело запроса должно иметь вид:
		'grant_type': "",
        'username': 'test@test.com',
        'password': 'test',
        'scope': "",
        'client_id': "",
        'client_secret': ""
В ответ вернется jwt-token, который необходимо прикреплять в заголовках запроса:
		'Authorization': 'Bearer <your jwt-token>'

# Запуск приложения
Для запуска приложения необходимо сначала установить poetry и запустить виртуальное окружение. Установить необходимые зависимости можно командой 
		poetry install
из каталога FastAPIServer.

Чтобы установить переменные окружения создайте файл .env вида
		DB_USER=
		DB_PASS=
		DB_HOST=
		DB_PORT=
		DB_NAME=
		AUTH_SECRET=
		SMTP_USER=
		SMTP_PASSWORD=
		RABBIT_USER=
		RABBIT_PASS=
заполнив его своими значениями.		

Само приложение можно запустить командами
		poetry run uvicorn src.app:app
		poetry run celery src.celery_app:celery worker --loglevel=INFO
		poetry run celery src.celery_app:celery flower
находясь в каталоге FastAPIServer. 

Для корректной работы приложения необходимо иметь сервер базы данных и брокер сообщений.

Также из папки FastAPIServer можно запустить приложение в Docker командой
		docker-compose up

# Тестирование
Запустить существующие тесты можно командой 
		poetry pytest
Для тестирования применяется локальная тестовая база данных SQLite и библиотека pytest.

# Миграции 
Для миграции данных в данном приложении используется alembic. Выполнить миграции можно из корневой папки (FastAPIServer) командой
		poetry run alembic uprgade head
		
# Обращение к API
На данный момент API развернуто на сокете 80.90.186.118:8030
